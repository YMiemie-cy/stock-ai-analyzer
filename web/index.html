<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stock AI Analyzer 控制台</title>
    <link rel="icon" type="image/png" href="/static/logo.png" />
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <header>
      <div class="logo">
        <img src="/static/logo.png" alt="Stock AI Analyzer Logo" />
        <h1>Stock AI Analyzer 控制台</h1>
      </div>
      <nav>
        <button data-view="search" class="active">即时信号</button>
        <button data-view="portfolio">持仓监控</button>
      </nav>
    </header>

    <main>
      <section id="search-view" class="view active">
        <div class="analysis-header">
          <div class="form-card">
            <h2>输入股票，获取当前买卖建议</h2>
            <form id="search-form">
              <label>
                股票代码（逗号分隔）：
                <input
                  type="text"
                  id="tickers-input"
                  placeholder="例如：NVDA, AAPL, 600519"
                  required
                />
              </label>
              <div id="ticker-suggestions" class="suggestions hidden"></div>
              <div class="options">
                <label>
                  观测年数：
                  <input type="number" id="lookback-input" value="5" min="1" />
                </label>
                <label>
                  预测周期（周）：
                  <input type="number" id="horizon-input" value="12" min="1" />
                </label>
                <label>
                  阈值：
                  <input type="number" step="0.01" id="threshold-input" value="0.05" />
                </label>
                <label>
                  分析频率：
                  <select id="frequency-select">
                    <option value="weekly" selected>周线</option>
                    <option value="daily">日线</option>
                    <option value="combined">周线 + 日线</option>
                  </select>
                </label>
                <label class="checkbox">
                  <input type="checkbox" id="adaptive-checkbox" checked />
                  使用自适应阈值
                </label>
              </div>
              <button type="submit">开始分析</button>
            </form>
            <div id="search-status" class="status"></div>
          </div>
          <section id="overview-panel" class="overview-panel hidden">
            <div class="overview-primary">
              <div class="overview-headline">
                <p class="overview-title" id="overview-title">--</p>
                <p class="overview-subtitle">
                  最近更新 <span id="overview-updated">--</span>
                </p>
              </div>
              <div class="overview-metrics" id="overview-metrics">
                <div class="metric">
                  <span class="metric-label">买入</span>
                  <span class="metric-value" id="metric-buy">0</span>
                </div>
                <div class="metric">
                  <span class="metric-label">持有</span>
                  <span class="metric-value" id="metric-hold">0</span>
                </div>
                <div class="metric">
                  <span class="metric-label">卖出</span>
                  <span class="metric-value" id="metric-sell">0</span>
                </div>
              </div>
            </div>
            <div class="priority-alerts hidden" id="priority-alerts">
              <div class="priority-header">
                <span>优先处理</span>
                <button type="button" id="alerts-toggle" class="link-button">查看全部</button>
              </div>
              <ul id="priority-alerts-list"></ul>
            </div>
          </section>
        </div>
        <div class="result-controls hidden" id="result-controls">
          <div class="control-group">
            <label>
              筛选信号
              <select id="decision-filter">
                <option value="all">全部</option>
                <option value="buy">只看买入</option>
                <option value="hold">只看持有</option>
                <option value="sell">只看卖出</option>
              </select>
            </label>
            <label>
              排序方式
              <select id="sort-select">
                <option value="origin">默认顺序</option>
                <option value="confidence_desc">信心由高到低</option>
                <option value="prob_gap_desc">Prob Gap 由高到低</option>
                <option value="prob_buy_desc">买入概率由高到低</option>
                <option value="prob_sell_desc">卖出概率由高到低</option>
                <option value="quality_desc">信号质量由高到低</option>
                <option value="hit_ratio_desc">回测命中率由高到低</option>
                <option value="alpha_asc">按代码字母排序</option>
              </select>
            </label>
          </div>
          <div class="control-actions">
            <button type="button" id="refresh-search">刷新结果</button>
            <span id="search-updated" class="hint"></span>
          </div>
        </div>
        <details class="legend-card legend-card--floating" id="legend-search">
          <summary>标签说明</summary>
          <ul class="legend-list">
            <li>
              <span class="risk-badge risk-badge--low">信心不足</span>
              <p>买卖概率差距过小，模型对方向没有把握，宜观望或等下一条信号。</p>
            </li>
            <li>
              <span class="risk-badge risk-badge--low">质量偏低</span>
              <p>历史命中率较低，类似场景过去成功率不高，操作前需额外确认。</p>
            </li>
            <li>
              <span class="risk-badge risk-badge--flip">刚刚翻转</span>
              <p>信号刚发生变更，短期可能反复波动，建议分批执行或等待确认。</p>
            </li>
            <li>
              <span class="risk-badge risk-badge--edge">临界</span>
              <p>当前分数接近触发阈值，价格小幅波动就可能改判，需密切关注。</p>
            </li>
            <li>
              <span class="risk-badge">数据偏旧</span>
              <p>最新样本距离今天超过 5 天，建议刷新数据或切换到日线模式。</p>
            </li>
          </ul>
        </details>
        <section id="search-insights" class="insights hidden">
          <div class="insight-card" id="briefing-card">
            <div class="insight-card__header">
              <h3>开盘智能摘要</h3>
              <span id="briefing-generated" class="insight-caption"></span>
            </div>
            <p id="briefing-headline" class="insight-headline">暂无摘要</p>
            <div id="briefing-top" class="insight-list"></div>
            <div id="briefing-watchlist" class="insight-watchlist"></div>
          </div>
          <div class="insight-card" id="alerts-card">
            <div class="insight-card__header">
              <h3>事件提醒</h3>
              <span class="insight-caption">自动监控大幅波动与阈值风险</span>
            </div>
            <ul id="event-alerts" class="insight-ul"></ul>
          </div>
          <div class="insight-card" id="market-card">
            <div class="insight-card__header">
              <h3>市场布控</h3>
              <span class="insight-caption">按市场统计信号热度与风险指标</span>
            </div>
            <div id="market-summary" class="insight-list"></div>
          </div>
          <div class="insight-card" id="scenario-card">
            <div class="insight-card__header">
              <h3>压力测试</h3>
              <span class="insight-caption">快速预估不同冲击下的信号稳定性</span>
            </div>
            <ul id="scenario-overview" class="insight-ul"></ul>
          </div>
          <div class="insight-card" id="prompts-card">
            <div class="insight-card__header">
              <h3>快捷提问建议</h3>
              <span class="insight-caption">一键抛出高频问题</span>
            </div>
            <ul id="prompt-suggestions" class="insight-ul"></ul>
          </div>
        </section>
        <div id="search-results"></div>
        <div id="chat-panel" class="chat-panel hidden">
          <div class="chat-panel__header">
            <h3>AI 投顾问答</h3>
            <label class="chat-bot-select">
              模型：
              <select id="chat-bot">
                <option value="GPT-5">GPT-5</option>
                <option value="Claude-Sonnet-4.5">Claude-Sonnet-4.5</option>
                <option value="GPT-4o">GPT-4o</option>
                <option value="Gemini-2.5-Pro">Gemini-2.5-Pro</option>
                <option value="DeepSeek-R1">DeepSeek-R1</option>
              </select>
            </label>
          </div>
          <div class="chat-prompts">
            <span>快捷提问：</span>
            <button type="button" data-target="search" data-prompt="今天哪些信号最需要我立即关注？">今日重点关注？</button>
            <button type="button" data-target="search" data-prompt="短线风险主要来自哪些标的？">短线风险在哪？</button>
            <button type="button" data-target="search" data-prompt="如果信号突然反转，我应该如何调整仓位？">信号反转应对？</button>
          </div>
          <div id="chat-status" class="status"></div>
          <div id="chat-log" class="chat-log"></div>
          <form id="chat-form" class="chat-form">
            <textarea
              id="chat-input"
              rows="3"
              placeholder="输入你的问题，例如：当前是否适合增持？"
              required
            ></textarea>
            <div class="chat-form__actions">
              <button type="submit">发送</button>
            </div>
          </form>
        </div>
      </section>

      <section id="portfolio-view" class="view">
        <h2>持仓信号实时监控</h2>
        <div class="actions">
          <button id="refresh-portfolio">立即刷新</button>
          <span id="portfolio-status" class="status"></span>
        </div>
        <details class="legend-card legend-card--floating" id="legend-portfolio">
          <summary>标签说明</summary>
          <ul class="legend-list">
            <li>
              <span class="risk-badge risk-badge--low">信心不足</span>
              <p>买卖概率差距小，模型倾向不明显，可等待更清晰的信号再调整仓位。</p>
            </li>
            <li>
              <span class="risk-badge risk-badge--low">质量偏低</span>
              <p>历史命中率偏弱，此类信号过去表现一般，执行前请结合其他依据。</p>
            </li>
            <li>
              <span class="risk-badge risk-badge--flip">刚刚翻转</span>
              <p>建议或风险提示刚变更，短线波动可能放大，适合小步试探或锁盈。</p>
            </li>
            <li>
              <span class="risk-badge risk-badge--edge">临界</span>
              <p>当前得分接近阈值，下一根 K 线就可能触发反向操作，适合重点盯盘。</p>
            </li>
            <li>
              <span class="risk-badge">数据偏旧</span>
              <p>最新数据距离今天偏久（≥5 天），请刷新分析或切换至日线以获取更新。</p>
            </li>
          </ul>
        </details>
        <div id="portfolio-health" class="insight-card hidden">
          <div class="insight-card__header">
            <h3>持仓健康面板</h3>
            <span id="portfolio-health-caption" class="insight-caption"></span>
          </div>
          <div id="portfolio-health-summary" class="insight-headline"></div>
          <div id="portfolio-health-body" class="insight-list"></div>
          <div id="portfolio-health-missing" class="insight-caption"></div>
        </div>
        <div class="result-controls hidden" id="portfolio-controls">
          <div class="control-group">
            <label>
              分析频率
              <select id="portfolio-frequency-select">
                <option value="weekly" selected>周线</option>
                <option value="daily">日线</option>
                <option value="combined">周线 + 日线</option>
              </select>
            </label>
            <label>
              筛选信号
              <select id="portfolio-filter-select">
                <option value="all">全部</option>
                <option value="buy">只看买入</option>
                <option value="hold">只看持有</option>
                <option value="sell">只看卖出</option>
              </select>
            </label>
            <label>
              排序方式
              <select id="portfolio-sort-select">
                <option value="origin">默认顺序</option>
                <option value="confidence_desc">信心由高到低</option>
                <option value="prob_gap_desc">Prob Gap 由高到低</option>
                <option value="prob_buy_desc">买入概率由高到低</option>
                <option value="prob_sell_desc">卖出概率由高到低</option>
                <option value="hit_ratio_desc">回测命中率由高到低</option>
                <option value="alpha_asc">按代码字母排序</option>
              </select>
            </label>
          </div>
        </div>
        <div id="portfolio-results"></div>
        <div id="portfolio-chat-panel" class="chat-panel hidden">
          <div class="chat-panel__header">
            <h3>AI 投顾问答（持仓）</h3>
            <label class="chat-bot-select">
              模型：
              <select id="portfolio-chat-bot">
                <option value="GPT-5">GPT-5</option>
                <option value="Claude-Sonnet-4.5">Claude-Sonnet-4.5</option>
                <option value="GPT-4o">GPT-4o</option>
                <option value="Gemini-2.5-Pro">Gemini-2.5-Pro</option>
                <option value="DeepSeek-R1">DeepSeek-R1</option>
              </select>
            </label>
          </div>
          <div class="chat-prompts">
            <span>快捷提问：</span>
            <button type="button" data-target="portfolio" data-prompt="今天哪些仓位需要我优先调整？">今天调整什么？</button>
            <button type="button" data-target="portfolio" data-prompt="哪些持仓已经接近信号阈值，需要重点盯盘？">临界仓位？</button>
            <button type="button" data-target="portfolio" data-prompt="我今天应该加仓还是减仓？">加仓还是减仓？</button>
          </div>
          <div id="portfolio-chat-status" class="status"></div>
          <div id="portfolio-chat-log" class="chat-log"></div>
          <form id="portfolio-chat-form" class="chat-form">
            <textarea
              id="portfolio-chat-input"
              rows="3"
              placeholder="向 AI 询问持仓策略，例如：是否需要减仓？"
              required
            ></textarea>
            <div class="chat-form__actions">
              <button type="submit">发送</button>
            </div>
          </form>
        </div>
      </section>
    </main>

    <footer>
      <p>数据由本地模型计算，建议结合自身策略谨慎决策。</p>
    </footer>

    <script src="/static/script.js" type="module"></script>
  </body>
</html>
